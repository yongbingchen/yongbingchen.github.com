<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: gerrit | Yongbing's Blog]]></title>
  <link href="http://yongbingchen.github.com/blog/categories/gerrit/atom.xml" rel="self"/>
  <link href="http://yongbingchen.github.com/"/>
  <updated>2015-03-27T20:27:22-07:00</updated>
  <id>http://yongbingchen.github.com/</id>
  <author>
    <name><![CDATA[Yongbing Chen]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[create my own repo to manage bundle of git repositories]]></title>
    <link href="http://yongbingchen.github.com/blog/2015/03/27/create-my-own-repo-to-manage-bundle-of-git-repositories/"/>
    <updated>2015-03-27T17:35:00-07:00</updated>
    <id>http://yongbingchen.github.com/blog/2015/03/27/create-my-own-repo-to-manage-bundle-of-git-repositories</id>
    <content type="html"><![CDATA[<h2>Create repo manifest:</h2>

<ol>
<li>As gerrit server administrator, create below pojects in gerrit server

<ol>
<li>container //for global access control, choose "Only serve as parent for other projects", unselect "Create initial empty commit"</li>
<li>container/repo_1/manifest //repo manifest, access right inherit from "container", unselect "Only serve as parent for other projects", select "Create initial empty commit"</li>
<li>container/repo_1/git_one //child project inside the repo, access right inherit from "container", unselect "Only serve as parent for other projects", select "Create initial empty commit".</li>
<li>container/repo_1/git_two</li>
</ol>
</li>
<li>Create my own repo config:

<ol>
<li>on a client working machine, checkout the manifest git first: <code>~$ git clone ssh://gerrit2@gerritreview.com:29418/container/repo_1/manifest</code></li>
<li>add a new file manifest.xml to the git as below, and merge it to master branch:
```xml
&lt;?xml version="1.0" encoding="UTF-8"?>
<manifest>

<pre><code> &lt;remote  name="my_repo"
         fetch="ssh://gerritreview.com:29418/"
         review="http://gerritreview.com/gerrit/"
         /&gt;
 &lt;default revision="my_working_branch"
         remote="my_repo"
         sync-j="4"
         /&gt;

 &lt;project path="container/repo_1/git_one" name="container/repo_1/git_one" /&gt;
 &lt;project path="container/repo_1/git_two" name="container/repo_1/git_two" /&gt;
</code></pre>

<p></manifest>
```</p></li>
</ol>
</li>
<li>On gerrit server, create a working "Branch Name" "my_working_branch" on these three projects, with "Initial Revision" set to "master" in https://gerritreview.com/gerrit/#/admin/projects/container/repo_1/${GIT_NAME},branches</li>
<li>On a client's working machine, checkout the repo with below command:
<code>~$ repo init -u ssh://gerritreview.com:29418/container/repo_1/manifest -b my_working_branch -m manifest.xml --repo-url https://chromium.googlesource.com/external/repo.git --no-repo-verify</code>
<code>~$ repo sync -j 32</code></li>
</ol>


<h2>Setup the access control rules for this repo:</h2>

<ol>
<li>define thress group and their access right:

<ol>
<li>developers  :can submit CL, checkout code, review +/_ 1</li>
<li>reviewers   :can review +/- 2</li>
<li>submitters  :can merge CL to working branch</li>
</ol>
</li>
<li>implement these rules in gerrit server:
First delete all default access permission granted for "Registered Users" from https://gerritreview.com/gerrit/#/admin/projects/All-Projects,access
Then create below access rules for the projects under container: {% img http://yongbingchen.github.com/images/git/repo/gerrit_server_access_control.jpeg  %}</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Loose coopling hierarchical gerrit workflow]]></title>
    <link href="http://yongbingchen.github.com/blog/2013/03/11/loose-coopling-hierarchical-gerrit-workflow/"/>
    <updated>2013-03-11T22:58:00-07:00</updated>
    <id>http://yongbingchen.github.com/blog/2013/03/11/loose-coopling-hierarchical-gerrit-workflow</id>
    <content type="html"><![CDATA[<p>As we are working on an Android project, we are handling a very large scale source tree (10GB level), including works from BSP team (bootloader, linux kernel), midware team (A/V codec, media framework),  and Android team (Android HAL, vendor specific Apks). We need to do weekly relaese for several products from single source tree, ensuring no quality degradation in the mean time.</p>

<p>A work flow serves these requirement needs to:</p>

<ol>
<li>have least cross team dependancy.</li>
<li>provide tight collaboration in developers.</li>
<li>easily locate bad node when doing release.</li>
</ol>


<p>To achive these requirements, I defined below branches:</p>

<ol>
<li>One trunk branch for releasing. Every node is a stable node (passed full test).</li>
<li>Every team has one independent developing branch, covering this team's source code partition, based on last release version, closed after current release is done.</li>
<li>Integration branch is based on last release version, will integrate above developing branches. Perform full test on this branch, cull out bad node when failed.</li>
</ol>


<p>And a workflow based on these branches:</p>

<ol>
<li>Every developer submits to developing branch (cross team submit is permitted), gerrit review process servers as first gate keeper in this stage. Add auto build, auto test in gerrit merge hook, let every commit has a build image, and this image will contain all its preceding commits, this makes possible of using binary search to cull out bad node in QA stage.</li>
<li>After submit window closed, integrators merge these developing branches into one integration branch, perform full test on the result, if failed, apply the failed case on all tail nodes of developing branches, this step picks out the failed developing branch. Then use binary search method on this developing branch to cull out the bad node, and update the developing branch. Iterate untill integration result pass full test.</li>
<li>Push the passed result into release branch, open submit window, start next developing/release cycle.</li>
</ol>


<p><em>Branches:</em>
{% img http://yongbingchen.github.com/images/gerrit/branches.jpg  %}</p>
]]></content>
  </entry>
  
</feed>
